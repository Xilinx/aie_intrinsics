<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3"/>
<title>AI Engine: Reduced Lane Addressing Scheme</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<style type="text/css"> .tg  {border-collapse:collapse;border-spacing:0;} .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;} .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;} .tg .tg-lboi{border-color:inherit;text-align:left;vertical-align:middle} .tg .tg-llyw{background-color:#c0c0c0;border-color:inherit;text-align:left;vertical-align:top} .tg .tg-fymr{font-weight:bold;border-color:inherit;text-align:left;vertical-align:top} .tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top} .tg .tg-t5pq{background-color:#cbcefb;color:#000000;border-color:inherit;text-align:left;vertical-align:top} </style><style type="text/css"> .tg  {border-collapse:collapse;border-spacing:0;} .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;} .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:1px;overflow:hidden;word-break:normal;border-color:black;} .tg .tg-lboi{border-color:inherit;text-align:left;vertical-align:middle} .tg .tg-llyw{background-color:#c0c0c0;border-color:inherit;text-align:left;vertical-align:top} .tg .tg-fymr{font-weight:bold;border-color:inherit;text-align:left;vertical-align:top} .tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top} .tg .tg-t5pq{background-color:#cbcefb;color:#000000;border-color:inherit;text-align:left;vertical-align:top} </style></head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="xilinx.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">AI Engine
   &#160;<span id="projectnumber">(AIE)             r2p15.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Overview</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>API&#160;Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__intr__lanesel__cmp.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Reduced Lane Addressing Scheme<div class="ingroups"><a class="el" href="group__intr__gpvectorop.html">Vector Operations</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p><a class="anchor" id="data_selection_cmp"></a> Intrinsics that operate on vectors but don't perform a multiplication follow a reduced or modified lane selection scheme with respect to macs/muls. Such operations are adds, subs, abs, vector compares or vector selections/shuffles. Since those instructions share the initial part of the integer macs/mults datapath, they operate mostly on fixed point numbers. The only exception are float select and shuffles because no arithmetic is performed. Floating point arithmetic is always done in the floating point datapath, more information <a class="el" href="group__intr__gpvectorfpop.html#fpops_explained">here</a>. The next table summarizes the lane selection scheme.</p>
<h3>Legend</h3>
<p><a class="el" href="group__intr__lanesel__cmp.html#regular">RA</a>: Regular selection scheme.</p>
<p><a class="el" href="group__intr__lanesel__cmp.html#regular16">RA_16</a>: Selection scheme used for 16 bits numbers.</p>
<p>na: Not implemented at intrinsics level.</p>
<p>fpdp: Floating point datapath.</p>
<table  class="tg">
<tr>
<th class="tg-lboi"></th><th class="tg-fymr">i32 </th><th class="tg-fymr">i16 </th><th class="tg-fymr">ci32 </th><th class="tg-fymr">ci16 </th><th class="tg-fymr">float </th><th class="tg-fymr">cfloat  </th></tr>
<tr>
<td class="tg-fymr">select/shuffle </td><td class="tg-0pky">RA </td><td class="tg-0pky">RA_16. <br/>
Offsets are relative to 32 bit.<br/>
Start is relative to 16 bit <br/>
but must be multiple of 2.<br/>
Square relative to 16 bits.  </td><td class="tg-0pky">RA. Start and offsets are <br/>
relative to a full ci32 (64bits).  </td><td class="tg-0pky">RA. Real and Imag <br/>
are never split. </td><td class="tg-0pky">RA </td><td class="tg-0pky">RA. Start and offsets are <br/>
relative to full cfp32 (64 bits)  </td></tr>
<tr>
<td class="tg-fymr">add/sub </td><td class="tg-0pky">RA </td><td class="tg-0pky">RA_16. <br/>
Offsets are relative to 32 bit.<br/>
Start is relative to 16 bit <br/>
but must be multiple of 2.<br/>
Square relative to 16 bits.<br/>
 </td><td class="tg-0pky">RA. Start and offsets are <br/>
relative to a full ci32. (64bits). </td><td class="tg-0pky">RA_16 modified. Start is doubled<br/>
to represent a full ci16. (32bits).<br/>
Offset follows the<br/>
RA_16 scheme.<br/>
16 bits permute is disabled.<br/>
 </td><td class="tg-t5pq">fpdp </td><td class="tg-t5pq">fpdp  </td></tr>
<tr>
<td class="tg-fymr">abs </td><td class="tg-0pky">RA </td><td class="tg-0pky">RA_16. <br/>
Offsets are relative to 32 bit.<br/>
Start is relative to 16 bit <br/>
but must be multiple of 2.<br/>
Square relative to 16 bits.<br/>
 </td><td class="tg-llyw">na </td><td class="tg-llyw">na </td><td class="tg-t5pq">fpdp </td><td class="tg-t5pq">fpdp  </td></tr>
<tr>
<td class="tg-fymr">cmp  </td><td class="tg-0pky">RA </td><td class="tg-0pky">RA_16. <br/>
Offsets are relative to 32 bit.<br/>
Start is relative to 16 bit <br/>
but must be multiple of 2.<br/>
Square relative to 16 bits.<br/>
 </td><td class="tg-llyw">na </td><td class="tg-llyw">na </td><td class="tg-t5pq">fpdp </td><td class="tg-t5pq">fpdp  </td></tr>
</table>
<dl class="section note"><dt>Note</dt><dd>The bit width of the datatype does not imply directly the selection scheme used i.e. with cint16, where the real and imaginary parts are always moved together and hence the addressing follow a general scheme.</dd></dl>
<p>The basic functionality of these intrinsics performs vector comparisons between data from two buffers, the X and Y buffers, with the other parameters and options allowing flexibility (data selection within the vectors). When a single input buffer is used both X and Y inputs are obtained (with the respective start/offsets/square parameters) from the input buffer.</p>
<h2>Regular Lane Selection Scheme (RA) </h2>
<p><a class="anchor" id="regular"></a> Doing "+1" always mean to advance by one lane in the input buffer. The bit width of the datatype is irrelevant.</p>
<pre class="fragment">for i in 0,rows:
    id[i] = start + offset[i]  %input samples
    out[i] = f( in[id[i]] ) //f can be add, abs, sel ...
</pre><h2>16bits Lane Selection Scheme (RA_16) </h2>
<p><a class="anchor" id="regular16"></a> </p>
<pre class="fragment">//in and out are always treated as 16bits vectors, in[i] and in[i+1] are 16bits apart

// First permutation stage

The concepts are simple:

  - N offsets covers N*2 output lanes -&gt; 2*idx
  - This means that each offset is used to move two adjacent values -&gt; perm_idx + 1
  - The parity of the idx selects the perm_idx formula

for (idx = 0 ; idx &lt; acc_lanes/2; idx += 1)

  if even idx:
    perm_idx = start + 2*offset[idx]

  else //odd idx
    perm_idx = start + 2*offset[idx] + 2*(offset[idx – 1] + 1 )

  data[2*idx  ]  =  input[ perm_idx    ]
  data[2*idx+1]  =  input[ perm_idx + 1] //This is just the adjacent one


// Second permutation stage
for ( idx = 0 ; idx &lt; acc_lanes; idx += 4)

  // Square is used to permute on a smaller granularity
  output[idx]    =  data[ square [ idx%4     ] ]
  output[idx+1]  =  data[ square [ idx%4 + 1 ] ]
  output[idx+2]  =  data[ square [ idx%4 + 2 ] ]
  output[idx+3]  =  data[ square [ idx%4 + 3 ] ]
</pre><p>Visually, what happens is the following (example for the first two idx):</p>
<pre class="fragment">- Assume that the even offset selects [c,d] and the odd offsets selets [g,h] (as an example)

  in =    | a | b [ c | d ] e | f [ g | h ] i | l | m |
  f(offset_[idx0])--^               ^
  g(offset_[idx1])------------------|

  Here the functions f,g represents the ones described in the previous pseudocode.

- Then, data is shaped like this
  data = | c | d | g | h | ..... The next ones are selected by idx2, idx3 ...

- The square parameter finalizes the permutations, assume square 0x0123

  out[0] = data[ square[0] ] = data[ 3 ] = h
  out[1] = data[ square[1] ] = data[ 2 ] = g
  out[2] = data[ square[2] ] = data[ 1 ] = d
  out[3] = data[ square[3] ] = data[ 0 ] = c
    ..

- And hence

  out = | h | g | d | c | .....</pre><dl class="section note"><dt>Note</dt><dd>The first permuation only accepts 32bit aligned indexes, hence start must be a multiple of 2.</dd></dl>
<h1>Integer intrinsic naming convention</h1>
<p>The general naming convention for the integer vector intrinsics is shown below:</p>
<pre class="fragment">  {ge|gt|le|lt|max|maxdiff|min}{16|32}
</pre><dl class="section note"><dt>Note</dt><dd>The 16 or 32 in the intrinsic name refers to the number of lanes returned in the output. For the intrinsics under <a class="el" href="group__intr__gpvectorop__bit__cmp.html">Vector Comparison</a> "lane" is a bit in the return word while for all others it is a word of either 16 or 32 bit (according to input size).</dd></dl>
<h1>Floating-point intrinsic naming convention</h1>
<p>The general naming convention for the floating vector compare intrinsics is shown below:</p>
<pre class="fragment">  fp{ge|gt|le|lt|max|min}
</pre><h3>Data offsetting for more than 8 output lanes</h3>
<p>When the output has more than 8 lanes (e.g. 16) there are extra offset parameters. Apart from the usual 'offsets' parameter there is an additional 'offsets_hi' parameter for the extra lanes. This extra parameter allows selecting the data that will be placed into the upper input lanes (8-16) of the multiplier.</p>
<h1>Examples</h1>
<p>We have a usecase to transpose a matrix contained in a <a class="el" href="group__dt__gpvector__1024.html#classv64int16">v64int16</a>. Note this is real 16-bit so we will use the <a class="el" href="group__intr__lanesel__cmp.html#regular16">real data scheme</a> described above with the select32 intrinsic (<a class="el" href="group__intr__gpvectorop__vec__sel.html">Vector Lane Selection</a>). <br/>
 Our input data is packed as 2x2 tiles in vector registers and we would also like to output in this same format. Input: </p>
<div class="fragment"><div class="line">00 01 10 11 02 03 12 13 04 05 14 15 06 07 16 17 20 21 30 31 22 23 32 33 24 25 34 35 26 27 36 37</div>
<div class="line">0                       8                       16                      24</div>
<div class="line">40 41 50 51 42 43 52 53 44 45 54 55 46 47 56 57 60 61 70 71 62 63 72 73 64 65 74 75 66 67 76 77</div>
<div class="line">32                      40                      48                      56</div>
</div><!-- fragment --><p>In this case we would use the following indexing for the matrix transpose in “2x2 tiles” </p>
<pre class="fragment">xstart=0,  xoffset=0x----0800, xoffset_hi=0x----0a02, xsquare=0x3120
ystart=32, yoffset=0x0800----, yoffset_hi=0x0a02----, ysquare=0x3120
select = b11111111000000001111111100000000
</pre><p>32 outputs in 2x2 tiles: </p>
<div class="fragment"><div class="line">00 10 01 11 20 30 21 31 40 50 41 51 60 70 61 71 02 12 03 13 22 32 23 33 42 52 43 53 62 72 63 73</div>
<div class="line">0                       8                       16                      24</div>
</div><!-- fragment --><p>Constituting the first 4 rows of the transposed matrix w/ 2x2 packing: </p>
<div class="fragment"><div class="line">00 10 20 30 40 50 60 70</div>
<div class="line">01 11 21 31 41 51 61 71</div>
<div class="line">02 12 22 32 42 52 62 72</div>
<div class="line">03 13 23 33 43 53 63 73</div>
</div><!-- fragment --><p>If you worry that the 2x2 packing does not conform to the input requirements of the subsequent kernel, it is possible to generate a “row-major” transpose using a 2nd select32.</p>
<p>32 outputs of the 1st select32 in first example: </p>
<div class="fragment"><div class="line">00 10 01 11 20 30 21 31 40 50 41 51 60 70 61 71 02 12 03 13 22 32 23 33 42 52 43 53 62 72 63 73</div>
<div class="line">0                       8                       16                      24</div>
</div><!-- fragment --><pre class="fragment">xstart=0,  xoffset=0x15111410, xoffset_hi=0x1d191c18, xsquare=0x3210
ystart=-----------------------------------------
select = b00000000000000000000000000000000
</pre><p>32 outputs of the 2nd select32 generating the “row-major” transpose: </p>
<div class="fragment"><div class="line">00 10 20 30 40 50 60 70 01 11 21 31 41 51 61 71 02 12 22 32 42 52 62 72 03 13 23 33 43 53 63 73</div>
<div class="line">0                       8                       16                      24</div>
</div><!-- fragment --><p>Which is the first 4 rows of the “row-major” transpose: </p>
<div class="fragment"><div class="line">00 10 20 30 40 50 60 70</div>
<div class="line">01 11 21 31 41 51 61 71</div>
<div class="line">02 12 22 32 42 52 62 72</div>
<div class="line">03 13 23 33 43 53 63 73</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul class="foot">
    <li class="footer"> UG1078 &copy; 2020 Xilinx, Inc. All rights reserved. 
    </li>
  </ul>
</div>
</body>
</html>


